<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Travel Planner</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Tajawal:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <!-- Enhanced Background Animation Elements -->
    <div class="grid-pattern"></div>
    <div class="floating-orbs">
            <!-- <img src="tr.gif" alt="Background Image" class="background-image" style="width: 100%; height: 100%; object-fit: cover;"> -->

        <div class="orb"></div>
        <div class="orb"></div>
        <div class="orb"></div>
    </div>
    <div class="particles" id="particles"></div>

    <div class="container">
        <div class="header">
            <h1 class="title">AI Travel Planner</h1>
            <div class="header-controls">
                <button class="lang-toggle" onclick="toggleLanguage()" title="Switch Language">
                    <span class="lang-text">English</span>
                </button>
                <button class="theme-toggle" onclick="toggleTheme()" title="Toggle Theme">
                    <svg class="sun-icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z" />
                    </svg>
                    <svg class="moon-icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" style="display: none;">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z" />
                    </svg>
                </button>
            </div>
        </div>
        
        <div class="grid">
            <!-- Input Form Section -->
            <div class="panel">
                <h2 class="panel-title" data-ar="تفاصيل الرحلة" data-en="Trip Details">تفاصيل الرحلة</h2>
                <form id="travelForm" onsubmit="generateItinerary(event)">
                    <div class="form-group">
                        <label class="form-label" data-ar="تاريخ البداية" data-en="Start Date">تاريخ البداية</label>
                        <input type="date" class="form-input" id="startDate" required>
                    </div>

                    <div class="form-group">
                        <label class="form-label" data-ar="تاريخ النهاية" data-en="End Date">تاريخ النهاية</label>
                        <input type="date" class="form-input" id="endDate" required>
                    </div>

                    <div class="form-group">
                        <label class="form-label" data-ar="الوجهة" data-en="Destination">الوجهة</label>
                        <input type="text" class="form-input" id="destination" data-ar-placeholder="مثال: باريس، فرنسا" data-en-placeholder="Example: Paris, France" placeholder="مثال: باريس، فرنسا" required>
                    </div>

                    <div class="form-group">
                        <label class="form-label" data-ar="الاهتمامات" data-en="Interests">الاهتمامات</label>
                        <div class="preferences-group">
                            <label class="preference-checkbox">
                                <input type="checkbox" name="preferences" value="food">
                                <span data-ar="الطعام" data-en="Food">الطعام</span>
                            </label>
                            <label class="preference-checkbox">
                                <input type="checkbox" name="preferences" value="culture">
                                <span data-ar="الثقافة" data-en="Culture">الثقافة</span>
                            </label>
                            <label class="preference-checkbox">
                                <input type="checkbox" name="preferences" value="adventure">
                                <span data-ar="المغامرة" data-en="Adventure">المغامرة</span>
                            </label>
                            <label class="preference-checkbox">
                                <input type="checkbox" name="preferences" value="shopping">
                                <span data-ar="التسوق" data-en="Shopping">التسوق</span>
                            </label>
                            <label class="preference-checkbox">
                                <input type="checkbox" name="preferences" value="nature">
                                <span data-ar="الطبيعة" data-en="Nature">الطبيعة</span>
                            </label>
                            <label class="preference-checkbox">
                                <input type="checkbox" name="preferences" value="history">
                                <span data-ar="التاريخ" data-en="History">التاريخ</span>
                            </label>
                        </div>
                    </div>

                    <button type="submit" class="button" data-ar="توليد الخطة" data-en="Generate Plan">توليد الخطة</button>
                </form>
            </div>

            <!-- Itinerary Display Section -->
            <div class="panel">
                <h2 class="panel-title" data-ar="خطة الرحلة" data-en="Travel Plan">خطة الرحلة</h2>
                <div class="loading">
                    <span data-ar="جاري إنشاء الخطة..." data-en="Generating plan...">جاري إنشاء الخطة...</span>
                    <div class="spinner"></div>
                </div>
                <div id="itinerary" class="itinerary-container">
                    <!-- Itinerary will be displayed here -->
                </div>
            </div>
        </div>
    </div>

    <script>
        // Enhanced Particle System
        function createParticles() {
            const particlesContainer = document.getElementById('particles');
            const particleTypes = ['particle-small', 'particle-medium', 'particle-large', 'particle-glow', 'particle-star'];
            const particleCount = 50;
            
            for (let i = 0; i < particleCount; i++) {
                const particle = document.createElement('div');
                const randomType = particleTypes[Math.floor(Math.random() * particleTypes.length)];
                particle.className = `particle ${randomType}`;
                
                // Random horizontal position
                particle.style.left = Math.random() * 100 + '%';
                
                // Random animation delay and duration
                particle.style.animationDelay = Math.random() * 20 + 's';
                particle.style.animationDuration = (Math.random() * 15 + 10) + 's';
                
                // Add some horizontal drift
                const drift = (Math.random() - 0.5) * 100;
                particle.style.setProperty('--drift', drift + 'px');
                
                particlesContainer.appendChild(particle);
            }
        }

        // Continuous particle generation
        function generateNewParticle() {
            const particlesContainer = document.getElementById('particles');
            const particleTypes = ['particle-small', 'particle-medium', 'particle-large', 'particle-glow', 'particle-star'];
            
            const particle = document.createElement('div');
            const randomType = particleTypes[Math.floor(Math.random() * particleTypes.length)];
            particle.className = `particle ${randomType}`;
            
            particle.style.left = Math.random() * 100 + '%';
            particle.style.animationDuration = (Math.random() * 15 + 10) + 's';
            
            particlesContainer.appendChild(particle);
            
            // Remove particle after animation completes
            setTimeout(() => {
                if (particle.parentNode) {
                    particle.parentNode.removeChild(particle);
                }
            }, 35000);
        }

        // Initialize particles and start continuous generation
        window.addEventListener('load', () => {
            createParticles();
            // Generate new particles every 2 seconds
            setInterval(generateNewParticle, 2000);
        });

        const sunIcon = document.querySelector('.sun-icon');
        const moonIcon = document.querySelector('.moon-icon');
        const loadingElement = document.querySelector('.loading');
        const itineraryContainer = document.getElementById('itinerary');
        const langToggle = document.querySelector('.lang-toggle');
        const langText = document.querySelector('.lang-text');

        // Language handling
        function setLanguage(lang) {
            document.documentElement.lang = lang;
            document.documentElement.dir = lang === 'ar' ? 'rtl' : 'ltr';
            localStorage.setItem('language', lang);
            langText.textContent = lang === 'ar' ? 'English' : 'العربية';
            
            // Update all translatable elements
            document.querySelectorAll('[data-ar]').forEach(element => {
                element.textContent = element.getAttribute(`data-${lang}`);
            });

            // Update placeholders
            document.querySelectorAll('[data-ar-placeholder]').forEach(element => {
                element.placeholder = element.getAttribute(`data-${lang}-placeholder`);
            });
        }

        function toggleLanguage() {
            const currentLang = document.documentElement.lang;
            setLanguage(currentLang === 'ar' ? 'en' : 'ar');
        }

        // Initialize language
        const savedLang = localStorage.getItem('language') || 'ar';
        setLanguage(savedLang);

        // Theme handling
        function setTheme(theme) {
            document.documentElement.setAttribute('data-theme', theme);
            localStorage.setItem('theme', theme);
            sunIcon.style.display = theme === 'dark' ? 'block' : 'none';
            moonIcon.style.display = theme === 'dark' ? 'none' : 'block';
        }

        function toggleTheme() {
            const currentTheme = document.documentElement.getAttribute('data-theme');
            setTheme(currentTheme === 'dark' ? 'light' : 'dark');
        }

        // Initialize theme
        const savedTheme = localStorage.getItem('theme') || 'light';
        setTheme(savedTheme);

        function displayItinerary(itinerary) {
            itineraryContainer.innerHTML = '';
            const currentLang = document.documentElement.lang;
            const dayText = currentLang === 'ar' ? 'اليوم' : 'Day';
            
            itinerary.forEach(day => {
                const daySection = document.createElement('div');
                daySection.className = 'day-section';
                
                const dayTitle = document.createElement('h3');
                dayTitle.className = 'day-title';
                dayTitle.textContent = `${dayText} ${day.day}`;
                daySection.appendChild(dayTitle);

                day.activities.forEach(activity => {
                    const activityDiv = document.createElement('div');
                    activityDiv.className = 'activity';
                    
                    const activityTitle = document.createElement('h4');
                    activityTitle.className = 'activity-title';
                    activityTitle.textContent = activity.title;
                    
                    const activityDesc = document.createElement('p');
                    activityDesc.className = 'activity-description';
                    activityDesc.textContent = activity.description;
                    
                    activityDiv.appendChild(activityTitle);
                    activityDiv.appendChild(activityDesc);
                    daySection.appendChild(activityDiv);
                });

                itineraryContainer.appendChild(daySection);
            });
        }

        async function generateItinerary(event) {
            event.preventDefault();
            
            const startDate = document.getElementById('startDate').value;
            const endDate = document.getElementById('endDate').value;
            const destination = document.getElementById('destination').value;
            const preferences = Array.from(document.querySelectorAll('input[name="preferences"]:checked'))
                .map(cb => cb.value);

            if (!startDate || !endDate || !destination) {
                const currentLang = document.documentElement.lang;
                const errorMsg = currentLang === 'ar' ? 
                    'الرجاء ملء جميع الحقول المطلوبة' : 
                    'Please fill in all required fields';
                alert(errorMsg);
                return;
            }

            loadingElement.classList.add('active');
            itineraryContainer.innerHTML = '';

            try {
                const response = await fetch('/api/generate-itinerary', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        startDate,
                        endDate,
                        destination,
                        preferences,
                        language: document.documentElement.lang
                    })
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.error?.message || 'Failed to generate itinerary');
                }

                const data = await response.json();
                displayItinerary(data.itinerary);
            } catch (error) {
                const currentLang = document.documentElement.lang;
                const errorPrefix = currentLang === 'ar' ? '❌ حدث خطأ:' : '❌ Error:';
                itineraryContainer.innerHTML = `
                    <div class="error-message">
                        ${errorPrefix} ${error.message}
                    </div>
                `;
            } finally {
                loadingElement.classList.remove('active');
            }
        }
    </script>
</body>
</html>
