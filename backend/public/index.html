<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="theme-color" content="#667eea">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="AI Travel Planner">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="google-adsense-account" content="ca-pub-8025151941140662">
    <title>AI Travel Planner </title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Tajawal:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="styles-enhanced.css">
    <link rel="stylesheet" href="styles-enhanced-glow.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="manifest" href="manifest.json">
</head>
<body>    <!-- Enhanced Background Animation Elements -->
    <div class="grid-pattern"></div>
    <div class="floating-orbs">
        <div class="orb"></div>
        <div class="orb"></div>
        <div class="orb"></div>
    </div>
    <div class="particles" id="particles"></div>
    
    <!-- New Glow Effects -->
    <div class="glow-rings">
        <div class="glow-ring"></div>
        <div class="glow-ring"></div>
        <div class="glow-ring"></div>
        <div class="glow-ring"></div>
    </div>
    
    <div class="glow-orbs">
        <div class="glow-orb"></div>
        <div class="glow-orb"></div>
        <div class="glow-orb"></div>
        <div class="glow-orb"></div>
    </div>
    
    <div class="light-beams">
        <div class="light-beam"></div>
        <div class="light-beam"></div>
        <div class="light-beam"></div>
    </div>
    
    <div class="glow-dots">
        <div class="glow-dot"></div>
        <div class="glow-dot"></div>
        <div class="glow-dot"></div>
        <div class="glow-dot"></div>
        <div class="glow-dot"></div>
    </div>

    <!-- Trip Countdown Timer -->
    <div id="countdown-banner" class="countdown-banner" style="display: none;">
        <div class="countdown-content">
            <h3 data-ar="Ø§Ù„Ø¹Ø¯ Ø§Ù„ØªÙ†Ø§Ø²Ù„ÙŠ Ù„Ù„Ø±Ø­Ù„Ø©" data-en="Trip Countdown">Ø§Ù„Ø¹Ø¯ Ø§Ù„ØªÙ†Ø§Ø²Ù„ÙŠ Ù„Ù„Ø±Ø­Ù„Ø©</h3>
            <div class="countdown-timer">
                <div class="time-unit">
                    <span class="time-value" id="days">00</span>
                    <span class="time-label" data-ar="Ø£ÙŠØ§Ù…" data-en="Days">Ø£ÙŠØ§Ù…</span>
                </div>
                <div class="time-unit">
                    <span class="time-value" id="hours">00</span>
                    <span class="time-label" data-ar="Ø³Ø§Ø¹Ø§Øª" data-en="Hours">Ø³Ø§Ø¹Ø§Øª</span>
                </div>
                <div class="time-unit">
                    <span class="time-value" id="minutes">00</span>
                    <span class="time-label" data-ar="Ø¯Ù‚Ø§Ø¦Ù‚" data-en="Minutes">Ø¯Ù‚Ø§Ø¦Ù‚</span>
                </div>
                <div class="time-unit">
                    <span class="time-value" id="seconds">00</span>
                    <span class="time-label" data-ar="Ø«ÙˆØ§Ù†ÙŠ" data-en="Seconds">Ø«ÙˆØ§Ù†ÙŠ</span>
                </div>
            </div>
            <button class="close-countdown" onclick="hideCountdown()">Ã—</button>
        </div>
    </div>

    <div class="container">
        <div class="header">
            <h1 class="title">
                 AI Travel Planner
                <span class="version-badge">Enhanced</span>
            </h1>
            <div class="header-controls">
                <button class="lang-toggle" onclick="toggleLanguage()" title="Switch Language">
                    <span class="lang-text">English</span>
                </button>
                <button class="theme-toggle" onclick="toggleTheme()" title="Toggle Theme">
                    <svg class="sun-icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z" />
                    </svg>
                    <svg class="moon-icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" style="display: none;">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z" />
                    </svg>
                </button>
                <button class="ai-assistant-toggle" onclick="toggleAIAssistant()" title="AI Assistant">
                    ğŸ¤–
                </button>
            </div>
        </div>
        
        <!-- Feature Navigation Tabs -->
        <div class="feature-tabs">
            <button class="tab-button active" onclick="showTab('planning')" data-ar="Ø§Ù„ØªØ®Ø·ÙŠØ·" data-en="Planning">Ø§Ù„ØªØ®Ø·ÙŠØ·</button>
            <button class="tab-button" onclick="showTab('photos')" data-ar="Ø§Ù„ØµÙˆØ±" data-en="Photos">Ø§Ù„ØµÙˆØ±</button>
        </div>

        <div class="grid">
            <!-- Planning Tab -->
            <div id="planning-tab" class="tab-content active">
                <!-- Enhanced Input Form Section with Chat UI -->
                <div class="panel">
                    <h2 class="panel-title" data-ar="ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø±Ø­Ù„Ø©" data-en="Trip Details">ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø±Ø­Ù„Ø©</h2>
                    <form id="travelForm" onsubmit="generateItinerary(event)">
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label" data-ar="ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©" data-en="Start Date">ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©</label>
                                <input type="date" class="form-input" id="startDate" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label" data-ar="ØªØ§Ø±ÙŠØ® Ø§Ù„Ù†Ù‡Ø§ÙŠØ©" data-en="End Date">ØªØ§Ø±ÙŠØ® Ø§Ù„Ù†Ù‡Ø§ÙŠØ©</label>
                                <input type="date" class="form-input" id="endDate" required>
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-group flex-2">
                                <label class="form-label" data-ar="Ø§Ù„ÙˆØ¬Ù‡Ø©" data-en="Destination">Ø§Ù„ÙˆØ¬Ù‡Ø©</label>
                                <input type="text" class="form-input" id="destination" data-ar-placeholder="Ù…Ø«Ø§Ù„: Ø¨Ø§Ø±ÙŠØ³ØŒ ÙØ±Ù†Ø³Ø§" data-en-placeholder="Example: Paris, France" placeholder="Ù…Ø«Ø§Ù„: Ø¨Ø§Ø±ÙŠØ³ØŒ ÙØ±Ù†Ø³Ø§" required>
                            </div>
                        </div>
                        

                        <div class="form-group">
                            <label class="form-label" data-ar="Ø§Ù„Ø§Ù‡ØªÙ…Ø§Ù…Ø§Øª (Ø¯Ø±Ø¯Ø´Ø©)" data-en="Interests (Chat)">Ø§Ù„Ø§Ù‡ØªÙ…Ø§Ù…Ø§Øª (Ø¯Ø±Ø¯Ø´Ø©)</label>
                            <div id="chat-container" class="card">
                                <div id="chat-history" class="chat-history"></div>
                                <form id="chat-form" class="chat-form" onsubmit="handlePlannerChat(event)">
                                    <input type="text" id="chat-input" class="form-input" data-ar-placeholder="ØµÙ Ø§Ù‡ØªÙ…Ø§Ù…Ø§ØªÙƒ Ù…Ø«Ù„: Ø§Ù„Ù…ØªØ§Ø­ÙØŒ Ø§Ù„Ø·Ø¹Ø§Ù… Ø§Ù„Ù…Ø­Ù„ÙŠØŒ Ø§Ù„Ø·Ø¨ÙŠØ¹Ø©" data-en-placeholder="Describe interests like: museums, local food, nature" placeholder="ØµÙ Ø§Ù‡ØªÙ…Ø§Ù…Ø§ØªÙƒ Ù…Ø«Ù„: Ø§Ù„Ù…ØªØ§Ø­ÙØŒ Ø§Ù„Ø·Ø¹Ø§Ù… Ø§Ù„Ù…Ø­Ù„ÙŠØŒ Ø§Ù„Ø·Ø¨ÙŠØ¹Ø©" autocomplete="off" required>
                                    <button type="submit" class="button primary" data-ar="Ø¥Ø±Ø³Ø§Ù„" data-en="Send">Ø¥Ø±Ø³Ø§Ù„</button>
                                </form>
                            </div>
                        </div>

                        <div class="button-group">
                            <button type="submit" class="button primary" data-ar="ØªÙˆÙ„ÙŠØ¯ Ø§Ù„Ø®Ø·Ø©" data-en="Generate Plan">ØªÙˆÙ„ÙŠØ¯ Ø§Ù„Ø®Ø·Ø©</button>
                            <button type="button" class="button secondary" onclick="loadSampleTrip()" data-ar="Ù…Ø«Ø§Ù„ Ø³Ø±ÙŠØ¹" data-en="Quick Sample">Ù…Ø«Ø§Ù„ Ø³Ø±ÙŠØ¹</button>
                        </div>
                    </form>
                </div>

                <!-- Enhanced Itinerary Display Section -->
                <div class="panel">
                    <div class="panel-header">
                        <h2 class="panel-title" data-ar="Ø®Ø·Ø© Ø§Ù„Ø±Ø­Ù„Ø©" data-en="Travel Plan">Ø®Ø·Ø© Ø§Ù„Ø±Ø­Ù„Ø©</h2>
                        <div id="interests-badge" class="interests-badge" style="display:none"></div>
                        <div class="panel-actions" id="itinerary-actions" style="display: none;">
                            <button class="action-btn" onclick="shareItinerary()" title="Share">ğŸ“¤</button>
                            <button class="action-btn" onclick="saveItinerary()" title="Save">ğŸ’¾</button>
                            <button class="action-btn" onclick="startCountdown()" title="Start Countdown">â°</button>
                        </div>
                    </div>
                    <div class="loading">
                        <span data-ar="Ø¬Ø§Ø±ÙŠ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø®Ø·Ø©..." data-en="Generating plan...">Ø¬Ø§Ø±ÙŠ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø®Ø·Ø©...</span>
                        <div class="spinner"></div>
                    </div>
                    <div id="itinerary" class="itinerary-container">
                        <div class="welcome-message">
                            <h3 data-ar="Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ ÙÙŠ Ù…Ø®Ø·Ø· Ø§Ù„Ø³ÙØ± Ø¨Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ!" data-en="Welcome to AI Travel Planner!">Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ ÙÙŠ Ù…Ø®Ø·Ø· Ø§Ù„Ø³ÙØ± Ø¨Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ!</h3>
                            <p data-ar="Ø§Ù…Ù„Ø£ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ Ø£Ø¹Ù„Ø§Ù‡ Ù„Ø¥Ù†Ø´Ø§Ø¡ Ø®Ø·Ø© Ø³ÙØ± Ù…Ø®ØµØµØ© ÙˆØ°ÙƒÙŠØ©" data-en="Fill out the form above to create a personalized, intelligent travel plan">Ø§Ù…Ù„Ø£ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ Ø£Ø¹Ù„Ø§Ù‡ Ù„Ø¥Ù†Ø´Ø§Ø¡ Ø®Ø·Ø© Ø³ÙØ± Ù…Ø®ØµØµØ© ÙˆØ°ÙƒÙŠØ©</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Photos Tab -->
            <div id="photos-tab" class="tab-content">
                <div class="panel">
                    <h2 class="panel-title" data-ar="ØµÙˆØ± Ø§Ù„ÙˆØ¬Ù‡Ø©" data-en="Destination Photos">ØµÙˆØ± Ø§Ù„ÙˆØ¬Ù‡Ø©</h2>
                    <div class="photos-input">
                        <input type="text" id="photosDestination" class="form-input" data-ar-placeholder="Ø§Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„ÙˆØ¬Ù‡Ø©" data-en-placeholder="Enter destination name" placeholder="Ø§Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„ÙˆØ¬Ù‡Ø©">
                        <button onclick="getPhotos()" class="button primary" data-ar="Ø¬Ù„Ø¨ Ø§Ù„ØµÙˆØ±" data-en="Get Photos">Ø¬Ù„Ø¨ Ø§Ù„ØµÙˆØ±</button>
                    </div>
                    <div id="photos-gallery" class="photos-gallery">
                        <div class="photos-placeholder">
                            <div class="photos-icon">ğŸ“¸</div>
                            <p data-ar="Ø§Ø³ØªÙƒØ´Ù ØµÙˆØ± Ø¬Ù…ÙŠÙ„Ø© Ù„Ù„ÙˆØ¬Ù‡Ø©" data-en="Explore beautiful photos of your destination">Ø§Ø³ØªÙƒØ´Ù ØµÙˆØ± Ø¬Ù…ÙŠÙ„Ø© Ù„Ù„ÙˆØ¬Ù‡Ø©</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- AI Travel Assistant -->
        <div id="ai-assistant" class="ai-assistant" style="display: none;">
            <div class="assistant-header">
                <h3 data-ar="Ù…Ø³Ø§Ø¹Ø¯ Ø§Ù„Ø³ÙØ± Ø§Ù„Ø°ÙƒÙŠ" data-en="AI Travel Assistant">Ù…Ø³Ø§Ø¹Ø¯ Ø§Ù„Ø³ÙØ± Ø§Ù„Ø°ÙƒÙŠ</h3>
                <button class="close-assistant" onclick="toggleAIAssistant()">Ã—</button>
            </div>
            <div class="assistant-chat" id="assistant-chat">
                <div class="assistant-message">
                    <div class="message-content" data-ar="Ù…Ø±Ø­Ø¨Ø§Ù‹! Ø£Ù†Ø§ Ù…Ø³Ø§Ø¹Ø¯Ùƒ Ø§Ù„Ø°ÙƒÙŠ Ù„Ù„Ø³ÙØ±. ÙƒÙŠÙ ÙŠÙ…ÙƒÙ†Ù†ÙŠ Ù…Ø³Ø§Ø¹Ø¯ØªÙƒ Ø§Ù„ÙŠÙˆÙ…ØŸ" data-en="Hello! I'm your AI travel assistant. How can I help you today?">Ù…Ø±Ø­Ø¨Ø§Ù‹! Ø£Ù†Ø§ Ù…Ø³Ø§Ø¹Ø¯Ùƒ Ø§Ù„Ø°ÙƒÙŠ Ù„Ù„Ø³ÙØ±. ÙƒÙŠÙ ÙŠÙ…ÙƒÙ†Ù†ÙŠ Ù…Ø³Ø§Ø¹Ø¯ØªÙƒ Ø§Ù„ÙŠÙˆÙ…ØŸ</div>
                </div>
            </div>
            <div class="assistant-input">
                <input type="text" id="assistantInput" class="form-input" data-ar-placeholder="Ø§ÙƒØªØ¨ Ø³Ø¤Ø§Ù„Ùƒ Ù‡Ù†Ø§..." data-en-placeholder="Type your question here..." placeholder="Ø§ÙƒØªØ¨ Ø³Ø¤Ø§Ù„Ùƒ Ù‡Ù†Ø§..." onkeypress="handleAssistantKeyPress(event)">
                <button onclick="sendToAssistant()" class="button primary">ğŸ“¤</button>
            </div>
        </div>

        <!-- Share Modal -->
        <div id="share-modal" class="modal" style="display: none;">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 data-ar="Ù…Ø´Ø§Ø±ÙƒØ© Ø§Ù„Ø®Ø·Ø©" data-en="Share Itinerary">Ù…Ø´Ø§Ø±ÙƒØ© Ø§Ù„Ø®Ø·Ø©</h3>
                    <button class="close-modal" onclick="closeShareModal()">Ã—</button>
                </div>
                <div class="modal-body">
                    <div class="share-options">
                        <button onclick="shareViaWhatsApp()" class="share-btn whatsapp">
                            <span class="share-icon">ğŸ“±</span>
                            <span data-ar="ÙˆØ§ØªØ³Ø§Ø¨" data-en="WhatsApp">ÙˆØ§ØªØ³Ø§Ø¨</span>
                        </button>
                        <button onclick="shareViaEmail()" class="share-btn email">
                            <span class="share-icon">ğŸ“§</span>
                            <span data-ar="Ø¥ÙŠÙ…ÙŠÙ„" data-en="Email">Ø¥ÙŠÙ…ÙŠÙ„</span>
                        </button>
                        <button onclick="copyShareLink()" class="share-btn copy">
                            <span class="share-icon">ğŸ”—</span>
                            <span data-ar="Ù†Ø³Ø® Ø§Ù„Ø±Ø§Ø¨Ø·" data-en="Copy Link">Ù†Ø³Ø® Ø§Ù„Ø±Ø§Ø¨Ø·</span>
                        </button>
                    </div>
                    <div class="share-link">
                        <input type="text" id="shareLink" class="form-input" readonly>
                    </div>
                </div>
            </div>
        </div>

        <!-- Photo Modal -->
        <div id="photo-modal" class="modal photo-modal" style="display: none;">
            <div class="modal-content photo-modal-content">
                <button class="close-modal" onclick="closePhotoModal()">Ã—</button>
                <img id="modal-photo" src="" alt="Photo">
                <div class="photo-info">
                    <h4 id="modal-photo-title"></h4>
                    <p id="modal-photo-description"></p>
                </div>
            </div>
        </div>        <!-- Enhanced Footer -->
        <footer class="footer">
            <div class="footer-content">
                <div class="footer-section">
                    <h4 data-ar="Ø§Ù„Ù…ÙŠØ²Ø§Øª Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©" data-en="New Features">Ø§Ù„Ù…ÙŠØ²Ø§Øª Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©</h4>
                    <ul>
                        
                        <li data-ar="Ù…Ø³Ø§Ø¹Ø¯ Ø§Ù„Ø³ÙØ± Ø§Ù„Ø°ÙƒÙŠ" data-en="AI Travel Assistant">Ù…Ø³Ø§Ø¹Ø¯ Ø§Ù„Ø³ÙØ± Ø§Ù„Ø°ÙƒÙŠ</li>
                    </ul>
                </div>
                <div class="footer-section">
                    <div>
                        <span data-ar="Ù…Ø·ÙˆØ± Ø¨ÙˆØ§Ø³Ø·Ø©" data-en="Developed by">Ù…Ø·ÙˆØ± Ø¨ÙˆØ§Ø³Ø·Ø©</span>
                        <a href="https://github.com/Byqb" target="_blank" rel="noopener noreferrer" class="github-link">
                            <span>@Byqb</span>
                            <svg class="github-icon" viewBox="0 0 24 24">
                                <path d="M12 0C5.374 0 0 5.373 0 12 0 17.302 3.438 21.8 8.207 23.387c.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23A11.509 11.509 0 0112 5.803c1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576C20.566 21.797 24 17.3 24 12c0-6.627-5.373-12-12-12z"/>
                            </svg>
                        </a>
                    </div>
                    <div>
                        <span data-ar="Â© 2025 Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø©" data-en="Â© 2025 All rights reserved">Â© 2025 Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø©</span>
                    </div>
                </div>
            </div>
        </footer>    </div>    <script>
        // Mobile and Touch Device Detection & Optimization
        const isMobile = window.innerWidth <= 768;
        const isTouchDevice = 'ontouchstart' in window || navigator.maxTouchPoints > 0;
        
        // Prevent zoom on form inputs (iOS)
        if (isMobile) {
            document.addEventListener('touchstart', function() {}, {passive: true});
            
            // Add meta viewport dynamically for better control
            const viewport = document.querySelector('meta[name="viewport"]');
            if (viewport && isTouchDevice) {
                viewport.setAttribute('content', 'width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover');
            }
            
            // Optimize particle count for mobile
            document.documentElement.style.setProperty('--particle-count', '20');
        }
        
        // Touch gesture improvements
        let touchStartY = 0;
        document.addEventListener('touchstart', function(e) {
            touchStartY = e.touches[0].clientY;
        }, {passive: true});
        
        document.addEventListener('touchmove', function(e) {
            const touchY = e.touches[0].clientY;
            const touchDiff = touchStartY - touchY;
            
            // Prevent pull-to-refresh on main content
            if (touchDiff < 0 && window.scrollY === 0) {
                e.preventDefault();
            }
        }, {passive: false});
        
        // Mobile AI Assistant optimizations
        function optimizeForMobile() {
            const assistant = document.getElementById('ai-assistant');
            if (assistant && isMobile) {
                // Add mobile-specific classes
                assistant.classList.add('mobile-optimized');
                
                // Improve touch scrolling
                const chat = document.getElementById('assistant-chat');
                if (chat) {
                    chat.style.webkitOverflowScrolling = 'touch';
                    chat.style.overflowScrolling = 'touch';
                }
            }
        }
        
        // PWA Installation Prompt
        let deferredPrompt;
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            
            // Show install button if desired
            if (isMobile) {
                console.log('PWA install prompt available');
            }
        });
        
        // Handle app installation
        window.addEventListener('appinstalled', (e) => {
            console.log('PWA was installed');
            deferredPrompt = null;
        });
        
        // Orientation change handling
        window.addEventListener('orientationchange', function() {
            setTimeout(function() {
                // Recalculate layout after orientation change
                const assistant = document.getElementById('ai-assistant');
                if (assistant && assistant.style.display !== 'none') {
                    // Reposition assistant if needed
                    assistant.style.height = window.innerHeight <= 600 ? '95vh' : '70vh';
                }
            }, 100);
        });

        // Global variables
        let currentItinerary = null;
        let currentDestination = '';
        let tripStartDate = null;
        let countdownInterval = null;

        // Enhanced Particle System
        function createParticles() {
            const particlesContainer = document.getElementById('particles');
            const particleTypes = ['particle-small', 'particle-medium', 'particle-large', 'particle-glow', 'particle-star'];
            const particleCount = 50;
            
            for (let i = 0; i < particleCount; i++) {
                const particle = document.createElement('div');
                const randomType = particleTypes[Math.floor(Math.random() * particleTypes.length)];
                particle.className = `particle ${randomType}`;
                
                particle.style.left = Math.random() * 100 + '%';
                particle.style.animationDelay = Math.random() * 20 + 's';
                particle.style.animationDuration = (Math.random() * 15 + 10) + 's';
                
                const drift = (Math.random() - 0.5) * 100;
                particle.style.setProperty('--drift', drift + 'px');
                
                particlesContainer.appendChild(particle);
            }
        }

        function generateNewParticle() {
            const particlesContainer = document.getElementById('particles');
            const particleTypes = ['particle-small', 'particle-medium', 'particle-large', 'particle-glow', 'particle-star'];
            
            const particle = document.createElement('div');
            const randomType = particleTypes[Math.floor(Math.random() * particleTypes.length)];
            particle.className = `particle ${randomType}`;
            
            particle.style.left = Math.random() * 100 + '%';
            particle.style.animationDuration = (Math.random() * 15 + 10) + 's';
            
            particlesContainer.appendChild(particle);
            
            setTimeout(() => {
                if (particle.parentNode) {
                    particle.parentNode.removeChild(particle);
                }
            }, 35000);
        }

        // Initialize particles
        window.addEventListener('load', () => {
            createParticles();
            setInterval(generateNewParticle, 2000);
        });

        // Language and Theme Management
        function setLanguage(lang) {
            document.documentElement.lang = lang;
            document.documentElement.dir = lang === 'ar' ? 'rtl' : 'ltr';
            localStorage.setItem('language', lang);
            
            const langText = document.querySelector('.lang-text');
            langText.textContent = lang === 'ar' ? 'English' : 'Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©';
            
            document.querySelectorAll('[data-ar]').forEach(element => {
                element.textContent = element.getAttribute(`data-${lang}`);
            });

            document.querySelectorAll('[data-ar-placeholder]').forEach(element => {
                element.placeholder = element.getAttribute(`data-${lang}-placeholder`);
            });

            // Update select options
            document.querySelectorAll('option[data-ar]').forEach(element => {
                element.textContent = element.getAttribute(`data-${lang}`);
            });
        }

        function toggleLanguage() {
            const currentLang = document.documentElement.lang;
            setLanguage(currentLang === 'ar' ? 'en' : 'ar');
        }

        function setTheme(theme) {
            document.documentElement.setAttribute('data-theme', theme);
            localStorage.setItem('theme', theme);
            
            const sunIcon = document.querySelector('.sun-icon');
            const moonIcon = document.querySelector('.moon-icon');
            
            if (theme === 'dark') {
                sunIcon.style.display = 'none';
                moonIcon.style.display = 'block';
            } else {
                sunIcon.style.display = 'block';
                moonIcon.style.display = 'none';
            }
        }

        function toggleTheme() {
            const currentTheme = document.documentElement.getAttribute('data-theme') || 'light';
            const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
            setTheme(newTheme);
        }

        // Tab Management
        function showTab(tabName) {
            // Hide all tabs
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Remove active class from all buttons
            document.querySelectorAll('.tab-button').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // Show selected tab
            document.getElementById(tabName + '-tab').classList.add('active');
            
            // Mark button as active
            event.target.classList.add('active');
        }

        // Itinerary Functions
        function displayItinerary(itinerary) {
            const container = document.getElementById('itinerary');
            container.innerHTML = '';
            const currentLang = document.documentElement.lang;
            const dayText = currentLang === 'ar' ? 'Ø§Ù„ÙŠÙˆÙ…' : 'Day';
            
            itinerary.forEach(day => {
                const daySection = document.createElement('div');
                daySection.className = 'day-section';
                
                const dayTitle = document.createElement('h3');
                dayTitle.className = 'day-title';
                dayTitle.textContent = `${dayText} ${day.day}`;
                daySection.appendChild(dayTitle);

                day.activities.forEach(activity => {
                    const activityDiv = document.createElement('div');
                    activityDiv.className = 'activity';
                    
                    const activityHeader = document.createElement('div');
                    activityHeader.className = 'activity-header';
                    
                    const activityTitle = document.createElement('h4');
                    activityTitle.className = 'activity-title';
                    activityTitle.textContent = activity.title;
                    
                    if (activity.time) {
                        const activityTime = document.createElement('span');
                        activityTime.className = 'activity-time';
                        activityTime.textContent = activity.time;
                        activityHeader.appendChild(activityTime);
                    }
                    
                    activityHeader.appendChild(activityTitle);
                    
                    const activityDesc = document.createElement('p');
                    activityDesc.className = 'activity-description';
                    activityDesc.textContent = activity.description;
                    
                    activityDiv.appendChild(activityHeader);
                    activityDiv.appendChild(activityDesc);
                    daySection.appendChild(activityDiv);
                });

                container.appendChild(daySection);
            });

            // Show action buttons
            document.getElementById('itinerary-actions').style.display = 'flex';
        }

        // Planner Chat -> AI -> Update Travel Plan (global once)
        let plannerChatId = null;
        function appendPlannerChat(sender, text) {
            const box = document.getElementById('chat-history');
            if (!box) return;
            const row = document.createElement('div');
            row.className = `chat-row ${sender}`;
            row.textContent = text;
            box.appendChild(row);
            box.scrollTop = box.scrollHeight;
        }

        async function handlePlannerChat(event) {
            event.preventDefault();
            const input = document.getElementById('chat-input');
            const text = input.value.trim();
            if (!text) return;
            const isFirstMessage = !plannerChatId;
            // Always treat this chat input as the authoritative interests list
            const parsedInterests = text.includes(',') ? text.split(',').map(s => s.trim()).filter(Boolean) : [text];
            window.currentInterests = parsedInterests;
            const badgeEl = document.getElementById('interests-badge');
            if (badgeEl) {
                const list = parsedInterests.join(', ');
                badgeEl.textContent = (document.documentElement.lang === 'ar' ? 'Ø§Ù„Ø§Ù‡ØªÙ…Ø§Ù…Ø§Øª: ' : 'Interests: ') + list;
                badgeEl.style.display = list ? 'block' : 'none';
            }
            appendPlannerChat('user', text);
            input.value = '';
            appendPlannerChat('assistant', 'â€¦');

            try {
                const res = await fetch('/api/itinerary-chat', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ chatId: plannerChatId, message: text, language: document.documentElement.lang })
                });
                const data = await res.json();
                const box = document.getElementById('chat-history');
                if (box && box.lastChild) box.lastChild.textContent = data.reply || 'OK';
                if (data.chatId) plannerChatId = data.chatId;
                if (data.meta) {
                    if (data.meta.destination) {
                        const destEl = document.getElementById('destination');
                        if (destEl) destEl.value = data.meta.destination;
                        currentDestination = data.meta.destination;
                    }
                    if (data.meta.startDate) {
                        const sd = document.getElementById('startDate');
                        if (sd) sd.value = data.meta.startDate;
                        tripStartDate = new Date(data.meta.startDate);
                    }
                    if (data.meta.endDate) {
                        const ed = document.getElementById('endDate');
                        if (ed) ed.value = data.meta.endDate;
                    }
                }
                if (Array.isArray(data.itinerary)) {
                    currentItinerary = data.itinerary;
                    displayItinerary(data.itinerary);
                }
            } catch (err) {
                const box = document.getElementById('chat-history');
                if (box && box.lastChild) box.lastChild.textContent = 'âŒ Error contacting planner';
            }
        }

        async function generateItinerary(event) {
            event.preventDefault();
            
            const startDate = document.getElementById('startDate').value;
            const endDate = document.getElementById('endDate').value;
            const destination = document.getElementById('destination').value;
            const preferences = Array.isArray(window.currentInterests)
                ? window.currentInterests
                : [];

            if (!startDate || !endDate || !destination) {
                const currentLang = document.documentElement.lang;
                const errorMsg = currentLang === 'ar' ? 
                    'Ø§Ù„Ø±Ø¬Ø§Ø¡ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©' : 
                    'Please fill in all required fields';
                alert(errorMsg);
                return;
            }

            const loadingElement = document.querySelector('.loading');
            const itineraryContainer = document.getElementById('itinerary');
            
            loadingElement.classList.add('active');
            itineraryContainer.innerHTML = '';

            try {
                const response = await fetch('/api/generate-itinerary', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        startDate,
                        endDate,
                        destination,
                        preferences,
                        language: document.documentElement.lang
                    })
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.error?.message || 'Failed to generate itinerary');
                }

                const data = await response.json();
                currentItinerary = data.itinerary;
                currentDestination = destination;
                tripStartDate = new Date(startDate);
                
                displayItinerary(data.itinerary);
                
                // Auto-populate other tabs
                
                document.getElementById('photosDestination').value = destination;
                
            } catch (error) {
                const currentLang = document.documentElement.lang;
                const errorPrefix = currentLang === 'ar' ? 'âŒ Ø­Ø¯Ø« Ø®Ø·Ø£:' : 'âŒ Error:';
                itineraryContainer.innerHTML = `
                    <div class="error-message">
                        ${errorPrefix} ${error.message}
                    </div>
                `;
            } finally {
                loadingElement.classList.remove('active');
            }
        }

        function loadSampleTrip() {
            const today = new Date();
            const nextWeek = new Date(today.getTime() + 7 * 24 * 60 * 60 * 1000);
            
            document.getElementById('startDate').value = today.toISOString().split('T')[0];
            document.getElementById('endDate').value = nextWeek.toISOString().split('T')[0];
            document.getElementById('destination').value = 'Paris, France';
            // travelers field removed
            
            // Check some preferences
            document.querySelector('input[value="culture"]').checked = true;
            document.querySelector('input[value="food"]').checked = true;
            document.querySelector('input[value="history"]').checked = true;
        }

        // Weather Functions
    // Removed Weather, Budget, Packing, and Tips features and related functions

        // Photos Functions
        async function getPhotos() {
            const destination = document.getElementById('photosDestination').value;
            if (!destination) return;
            
            const gallery = document.getElementById('photos-gallery');
            gallery.innerHTML = '<div class="loading-small">Loading photos...</div>';
            
            try {
                const response = await fetch(`/api/photos/${encodeURIComponent(destination)}`);
                const data = await response.json();
                
                if (!response.ok) throw new Error(data.error.message);
                
                gallery.innerHTML = `
                    <div class="photos-grid">
                        ${data.photos.map(photo => `
                            <div class="photo-item" onclick="openPhotoModal('${photo.url}', '${photo.description}', '${photo.photographer}')">
                                <img src="${photo.thumbnail}" alt="${photo.description}" loading="lazy">
                                <div class="photo-overlay">
                                    <span class="photo-title">${photo.description}</span>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                `;
            } catch (error) {
                gallery.innerHTML = `<div class="error-message">âŒ ${error.message}</div>`;
            }
        }

        function openPhotoModal(url, description, photographer) {
            document.getElementById('modal-photo').src = url;
            document.getElementById('modal-photo-title').textContent = description;
            document.getElementById('modal-photo-description').textContent = `Photo by ${photographer}`;
            document.getElementById('photo-modal').style.display = 'flex';
        }

        function closePhotoModal() {
            document.getElementById('photo-modal').style.display = 'none';
        }

        

        // AI Assistant Functions
        function toggleAIAssistant() {
            const assistant = document.getElementById('ai-assistant');
            assistant.style.display = assistant.style.display === 'none' ? 'flex' : 'none';
        }

        function handleAssistantKeyPress(event) {
            if (event.key === 'Enter') {
                sendToAssistant();
            }
        }        // Helper function to format markdown-like text
        function formatMarkdown(text) {
            if (!text) return '';
            
            return text
                // Bold text **text** -> <strong>text</strong>
                .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
                // Italic text *text* -> <em>text</em>
                .replace(/\*(.*?)\*/g, '<em>$1</em>')
                // Headers ### text -> <h3>text</h3>
                .replace(/^### (.*$)/gim, '<h3>$1</h3>')
                .replace(/^## (.*$)/gim, '<h2>$1</h2>')
                .replace(/^# (.*$)/gim, '<h1>$1</h1>')
                // Lists - item -> <li>item</li>
                .replace(/^- (.*$)/gim, '<li>$1</li>')
                // Code blocks `code` -> <code>code</code>
                .replace(/`(.*?)`/g, '<code>$1</code>')
                // Line breaks
                .replace(/\n/g, '<br>')
                // Wrap list items in ul tags
                .replace(/(<li>.*<\/li>)/s, '<ul>$1</ul>')
                // Fix multiple ul tags
                .replace(/<\/ul>\s*<ul>/g, '');
        }

        async function sendToAssistant() {
            const input = document.getElementById('assistantInput');
            const message = input.value.trim();
            if (!message) return;
            
            const chat = document.getElementById('assistant-chat');
            
            // Add user message
            chat.innerHTML += `
                <div class="user-message">
                    <div class="message-content">${message}</div>
                </div>
            `;
            
            input.value = '';
            chat.scrollTop = chat.scrollHeight;
            
            // Show typing indicator
            const typingIndicator = `
                <div class="assistant-message typing" id="typing-indicator">
                    <div class="message-content">
                        <div class="typing-dots">
                            <span></span>
                            <span></span>
                            <span></span>
                        </div>
                    </div>
                </div>
            `;
            chat.innerHTML += typingIndicator;
            chat.scrollTop = chat.scrollHeight;
            
            try {
                const response = await fetch('/api/ai-assistant', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        message,
                        language: document.documentElement.lang,
                        context: {
                            destination: currentDestination,
                            itinerary: currentItinerary
                        }
                    })
                });
                
                const data = await response.json();
                
                // Remove typing indicator
                const typingElement = document.getElementById('typing-indicator');
                if (typingElement) typingElement.remove();
                
                if (!response.ok) throw new Error(data.error.message);
                
                // Format and add assistant response with markdown support
                const formattedResponse = formatMarkdown(data.response);
                const providerBadge = data.provider ? `<span class="provider-badge">${data.provider === 'huggingface' ? 'ğŸ¤— HF' : 'ğŸš€ OR'}</span>` : '';
                
                chat.innerHTML += `
                    <div class="assistant-message">
                        <div class="message-content">${formattedResponse}</div>
                        ${providerBadge}
                    </div>
                `;
            } catch (error) {
                // Remove typing indicator
                const typingElement = document.getElementById('typing-indicator');
                if (typingElement) typingElement.remove();
                
                chat.innerHTML += `
                    <div class="assistant-message error">
                        <div class="message-content">âŒ ${error.message}</div>
                    </div>
                `;
            }
            
            chat.scrollTop = chat.scrollHeight;
        }

        // Sharing Functions
        async function saveItinerary() {
            if (!currentItinerary) return;
            
            try {
                const response = await fetch('/api/save-itinerary', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        itinerary: currentItinerary,
                        destination: currentDestination,
                        startDate: document.getElementById('startDate').value,
                        endDate: document.getElementById('endDate').value,
                        preferences: Array.isArray(window.currentInterests) ? window.currentInterests : Array.from(document.querySelectorAll('input[name="preferences"]:checked')).map(cb => cb.value),
                        language: document.documentElement.lang
                    })
                });
                
                const data = await response.json();
                if (!response.ok) throw new Error(data.error.message);
                
                alert(data.message);
                document.getElementById('shareLink').value = data.shareUrl;
            } catch (error) {
                alert('Error saving itinerary: ' + error.message);
            }
        }

        function shareItinerary() {
            document.getElementById('share-modal').style.display = 'flex';
        }

        function closeShareModal() {
            document.getElementById('share-modal').style.display = 'none';
        }

        function shareViaWhatsApp() {
            const shareUrl = document.getElementById('shareLink').value;
            if (shareUrl) {
                window.open(`https://wa.me/?text=Check out my travel plan: ${shareUrl}`, '_blank');
            }
        }

        function shareViaEmail() {
            const shareUrl = document.getElementById('shareLink').value;
            if (shareUrl) {
                window.open(`mailto:?subject=My Travel Itinerary&body=Check out my travel plan: ${shareUrl}`, '_blank');
            }
        }

        function copyShareLink() {
            const shareLink = document.getElementById('shareLink');
            shareLink.select();
            document.execCommand('copy');
            alert('Link copied to clipboard!');
        }

        // Countdown Functions
        function startCountdown() {
            if (!tripStartDate) return;
            
            document.getElementById('countdown-banner').style.display = 'flex';
            updateCountdown();
            countdownInterval = setInterval(updateCountdown, 1000);
        }

        function updateCountdown() {
            if (!tripStartDate) return;
            
            const now = new Date().getTime();
            const distance = tripStartDate.getTime() - now;
            
            if (distance < 0) {
                hideCountdown();
                return;
            }
            
            const days = Math.floor(distance / (1000 * 60 * 60 * 24));
            const hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
            const minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
            const seconds = Math.floor((distance % (1000 * 60)) / 1000);
            
            document.getElementById('days').textContent = days.toString().padStart(2, '0');
            document.getElementById('hours').textContent = hours.toString().padStart(2, '0');
            document.getElementById('minutes').textContent = minutes.toString().padStart(2, '0');
            document.getElementById('seconds').textContent = seconds.toString().padStart(2, '0');
        }

        function hideCountdown() {
            document.getElementById('countdown-banner').style.display = 'none';
            if (countdownInterval) {
                clearInterval(countdownInterval);
                countdownInterval = null;
            }
        }

        // Initialize
        const savedLang = localStorage.getItem('language') || 'ar';
        setLanguage(savedLang);

        const savedTheme = localStorage.getItem('theme') || 'light';
        setTheme(savedTheme);
    </script>
</body>
</html>
